---
const background = "/pages/services/cici-study-abroad-expert/journey/background.png";
const bgMobile = "/pages/services/cici-study-abroad-expert/journey/bg-mobile.png";
const arrowLeft = "/pages/services/cici-study-abroad-expert/journey/arrow-left.svg";
const arrowRight = "/pages/services/cici-study-abroad-expert/journey/arrow-right.svg";

const videos = [
  { src: "/pages/services/cici-study-abroad-expert/journey/videos/video_2.MP4", type: "video" },
  { src: "/pages/services/cici-study-abroad-expert/journey/videos/video_4.mov", type: "video" },
  { src: "/pages/services/cici-study-abroad-expert/journey/videos/video_5.mov", type: "video" },
  { src: "/pages/services/cici-study-abroad-expert/journey/videos/video_6.MOV", type: "video" },
  { src: "/pages/services/cici-study-abroad-expert/journey/videos/video_7.mov", type: "video" },
  { src: "/pages/services/cici-study-abroad-expert/journey/videos/video_8.mov", type: "video" },
];
---

<section class="relative w-full overflow-hidden -mt-6 -z-3">
  <picture>
    <source media="(min-width: 640px)" srcset={background} />
    <img src={bgMobile} alt="Roadmap background" class="w-full h-auto block" />
  </picture>

  <div class="absolute inset-0 flex flex-col items-center justify-center px-4 md:px-8 lg:px-12">
    <div class="flex items-center justify-center gap-1 md:gap-1 lg:gap-2 w-full max-w-xl mt-8 md:mt-20 lg:mt-36">
      <button id="prevBtn" class="shrink-0 hover:scale-110 transition-transform duration-300 cursor-pointer" aria-label="Previous media">
        <img src={arrowLeft} alt="Previous" class="w-14 h-14 md:w-16 md:h-16 lg:w-20 lg:h-20" />
      </button>
      <div class="flex-1 flex justify-center relative">
        <div id="mediaContainer" class="w-full max-w-[200px] md:max-w-[220px] lg:max-w-[250px] h-auto mt-6 md:mt-0">
          {
            videos.map((media, index) =>
              media.type === "video" ? (
                <video data-index={index} class={`media-item w-full h-auto object-contain shadow-2xl rounded-lg ${index === 0 ? "active" : "hidden"}`} controls preload="metadata">
                  <source src={media.src} type="video/mp4" />
                  Your browser does not support the video tag.
                </video>
              ) : (
                <img data-index={index} src={media.src} alt={`Journey image ${index + 1}`} class={`media-item w-full h-auto object-contain shadow-2xl rounded-lg ${index === 0 ? "active" : "hidden"}`} />
              )
            )
          }
        </div>
      </div>
      <button id="nextBtn" class="shrink-0 hover:scale-110 transition-transform duration-300 cursor-pointer" aria-label="Next media">
        <img src={arrowRight} alt="Next" class="w-14 h-14 md:w-16 md:h-16 lg:w-20 lg:h-20" />
      </button>
    </div>
    <div class="flex gap-2 mt-4 md:mt-6">
      {videos.map((_, index) => <div data-dot={index} class={`w-2 h-2 rounded-full transition-all duration-300 ${index === 0 ? "bg-white w-8" : "bg-white/50"}`} />)}
    </div>
  </div>
</section>

<script>
  let currentIndex = 0;
  const totalMedia = document.querySelectorAll(".media-item").length;
  const mediaItems = document.querySelectorAll(".media-item");
  const dots = document.querySelectorAll("[data-dot]");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");

  function updateMedia(newIndex: number) {
    // Pause all videos
    mediaItems.forEach((item) => {
      if (item instanceof HTMLVideoElement) {
        item.pause();
      }
    });

    // Hide current
    mediaItems[currentIndex].classList.remove("active");
    mediaItems[currentIndex].classList.add("hidden");
    dots[currentIndex].classList.remove("bg-white", "w-8");
    dots[currentIndex].classList.add("bg-white/50");

    // Show new
    currentIndex = newIndex;
    mediaItems[currentIndex].classList.remove("hidden");
    mediaItems[currentIndex].classList.add("active");
    dots[currentIndex].classList.remove("bg-white/50");
    dots[currentIndex].classList.add("bg-white", "w-8");
  }

  prevBtn?.addEventListener("click", () => {
    const newIndex = (currentIndex - 1 + totalMedia) % totalMedia;
    updateMedia(newIndex);
  });

  nextBtn?.addEventListener("click", () => {
    const newIndex = (currentIndex + 1) % totalMedia;
    updateMedia(newIndex);
  });

  // Optional: Click on dots to navigate
  dots.forEach((dot, index) => {
    dot.addEventListener("click", () => {
      updateMedia(index);
    });
    dot.classList.add("cursor-pointer");
  });
</script>
